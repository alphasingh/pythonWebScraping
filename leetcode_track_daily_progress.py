from http.client import HTTPSConnection as Connect
import json

# keep updating old_submissions with recent_ac_submissions
old_submissions = {
    "alphasingh": [{'id': '656115675', 'title': 'Maximum Non Negative Product in a Matrix', 'titleSlug': 'maximum-non-negative-product-in-a-matrix', 'timestamp': '1646774882'}, {'id': '655490709', 'title': 'Check if All Characters Have Equal Number of Occurrences', 'titleSlug': 'check-if-all-characters-have-equal-number-of-occurrences', 'timestamp': '1646700113'}, {'id': '655487587', 'title': 'Linked List Cycle', 'titleSlug': 'linked-list-cycle', 'timestamp': '1646699681'}, {'id': '655392693', 'title': 'Check if All Characters Have Equal Number of Occurrences', 'titleSlug': 'check-if-all-characters-have-equal-number-of-occurrences', 'timestamp': '1646685503'}, {'id': '654817184', 'title': 'Merge Two Sorted Lists', 'titleSlug': 'merge-two-sorted-lists', 'timestamp': '1646612121'}, {'id': '654815050', 'title': 'Count All Valid Pickup and Delivery Options', 'titleSlug': 'count-all-valid-pickup-and-delivery-options', 'timestamp': '1646611831'}, {'id': '654653819', 'title': 'Search Suggestions System', 'titleSlug': 'search-suggestions-system', 'timestamp': '1646591230'}, {'id': '654636107', 'title': 'Count Servers that Communicate', 'titleSlug': 'count-servers-that-communicate', 'timestamp': '1646589280'}, {'id': '654632086', 'title': 'Minimum Time Visiting All Points', 'titleSlug': 'minimum-time-visiting-all-points', 'timestamp': '1646588838'}, {'id': '654623617', 'title': 'Replace Non-Coprime Numbers in Array', 'titleSlug': 'replace-non-coprime-numbers-in-array', 'timestamp': '1646587911'}, {'id': '654270344', 'title': 'Append K Integers With Minimal Sum', 'titleSlug': 'append-k-integers-with-minimal-sum', 'timestamp': '1646540548'}, {'id': '654187893', 'title': 'Create Binary Tree From Descriptions', 'titleSlug': 'create-binary-tree-from-descriptions', 'timestamp': '1646535199'}, {'id': '654170614', 'title': 'Cells in a Range on an Excel Sheet', 'titleSlug': 'cells-in-a-range-on-an-excel-sheet', 'timestamp': '1646534272'}, {'id': '654123632', 'title': 'Check if Move is Legal', 'titleSlug': 'check-if-move-is-legal', 'timestamp': '1646527242'}, {'id': '654109247', 'title': 'Delete Characters to Make Fancy String', 'titleSlug': 'delete-characters-to-make-fancy-string', 'timestamp': '1646524914'}, {'id': '653930912', 'title': 'All Ancestors of a Node in a Directed Acyclic Graph', 'titleSlug': 'all-ancestors-of-a-node-in-a-directed-acyclic-graph', 'timestamp': '1646501425'}, {'id': '653905796', 'title': 'Sort the Jumbled Numbers', 'titleSlug': 'sort-the-jumbled-numbers', 'timestamp': '1646498592'}, {'id': '653898483', 'title': 'Most Frequent Number Following Key In an Array', 'titleSlug': 'most-frequent-number-following-key-in-an-array', 'timestamp': '1646497735'}, {'id': '653799800', 'title': 'Maximal Square', 'titleSlug': 'maximal-square', 'timestamp': '1646489869'}, {'id': '653798133', 'title': 'Count Square Submatrices with All Ones', 'titleSlug': 'count-square-submatrices-with-all-ones', 'timestamp': '1646489629'}],
    "jatinbindra171998": [{'id': '656070775', 'title': 'Detect Squares', 'titleSlug': 'detect-squares', 'timestamp': '1646768797'}, {'id': '655884632', 'title': 'Number of Pairs of Interchangeable Rectangles', 'titleSlug': 'number-of-pairs-of-interchangeable-rectangles', 'timestamp': '1646748602'}, {'id': '655876450', 'title': 'Reverse Prefix of Word', 'titleSlug': 'reverse-prefix-of-word', 'timestamp': '1646747545'}, {'id': '655183274', 'title': 'Sum of Beauty in the Array', 'titleSlug': 'sum-of-beauty-in-the-array', 'timestamp': '1646661816'}, {'id': '655169165', 'title': 'Final Value of Variable After Performing Operations', 'titleSlug': 'final-value-of-variable-after-performing-operations', 'timestamp': '1646659868'}, {'id': '654556392', 'title': 'Append K Integers With Minimal Sum', 'titleSlug': 'append-k-integers-with-minimal-sum', 'timestamp': '1646579563'}, {'id': '654529508', 'title': 'Create Binary Tree From Descriptions', 'titleSlug': 'create-binary-tree-from-descriptions', 'timestamp': '1646575797'}, {'id': '654171812', 'title': 'Cells in a Range on an Excel Sheet', 'titleSlug': 'cells-in-a-range-on-an-excel-sheet', 'timestamp': '1646534336'}, {'id': '654036707', 'title': 'Sort the Jumbled Numbers', 'titleSlug': 'sort-the-jumbled-numbers', 'timestamp': '1646513992'}, {'id': '654014122', 'title': 'Most Frequent Number Following Key In an Array', 'titleSlug': 'most-frequent-number-following-key-in-an-array', 'timestamp': '1646510953'}, {'id': '652611731', 'title': 'Maximum Difference Between Increasing Elements', 'titleSlug': 'maximum-difference-between-increasing-elements', 'timestamp': '1646317112'}, {'id': '651979588', 'title': 'Find Missing Observations', 'titleSlug': 'find-missing-observations', 'timestamp': '1646234940'}, {'id': '651965845', 'title': 'Minimum Moves to Convert String', 'titleSlug': 'minimum-moves-to-convert-string', 'timestamp': '1646233277'}, {'id': '651959646', 'title': 'Minimum Operations to Make a Uni-Value Grid', 'titleSlug': 'minimum-operations-to-make-a-uni-value-grid', 'timestamp': '1646232542'}, {'id': '651942867', 'title': 'Two Out of Three', 'titleSlug': 'two-out-of-three', 'timestamp': '1646230532'}, {'id': '651287293', 'title': 'Remove Colored Pieces if Both Neighbors are the Same Color', 'titleSlug': 'remove-colored-pieces-if-both-neighbors-are-the-same-color', 'timestamp': '1646146274'}, {'id': '651278154', 'title': 'Minimum Number of Moves to Seat Everyone', 'titleSlug': 'minimum-number-of-moves-to-seat-everyone', 'timestamp': '1646145063'}, {'id': '651274018', 'title': 'Simple Bank System', 'titleSlug': 'simple-bank-system', 'timestamp': '1646144549'}, {'id': '651268810', 'title': 'Check if Numbers Are Ascending in a Sentence', 'titleSlug': 'check-if-numbers-are-ascending-in-a-sentence', 'timestamp': '1646143873'}, {'id': '650610538', 'title': 'Next Greater Numerically Balanced Number', 'titleSlug': 'next-greater-numerically-balanced-number', 'timestamp': '1646060002'}],
    "sam_si": [{'id': '655962437', 'title': 'Find Eventual Safe States', 'titleSlug': 'find-eventual-safe-states', 'timestamp': '1646757413'}, {'id': '655890687', 'title': 'Push Dominoes', 'titleSlug': 'push-dominoes', 'timestamp': '1646749313'}, {'id': '655856316', 'title': 'Largest Sum of Averages', 'titleSlug': 'largest-sum-of-averages', 'timestamp': '1646744759'}, {'id': '655640511', 'title': 'Alphabet Board Path', 'titleSlug': 'alphabet-board-path', 'timestamp': '1646716365'}, {'id': '655622860', 'title': 'Linked List Cycle', 'titleSlug': 'linked-list-cycle', 'timestamp': '1646714676'}, {'id': '655297129', 'title': 'Time Based Key-Value Store', 'titleSlug': 'time-based-key-value-store', 'timestamp': '1646674550'}, {'id': '655264207', 'title': 'My Calendar II', 'titleSlug': 'my-calendar-ii', 'timestamp': '1646671227'}, {'id': '655016242', 'title': 'Merge Two Sorted Lists', 'titleSlug': 'merge-two-sorted-lists', 'timestamp': '1646635610'}, {'id': '654698635', 'title': 'Shortest Path in Binary Matrix', 'titleSlug': 'shortest-path-in-binary-matrix', 'timestamp': '1646596322'}, {'id': '654418175', 'title': 'Count All Valid Pickup and Delivery Options', 'titleSlug': 'count-all-valid-pickup-and-delivery-options', 'timestamp': '1646557560'}, {'id': '653700700', 'title': 'As Far from Land as Possible', 'titleSlug': 'as-far-from-land-as-possible', 'timestamp': '1646472848'}, {'id': '653688575', 'title': 'Pacific Atlantic Water Flow', 'titleSlug': 'pacific-atlantic-water-flow', 'timestamp': '1646470828'}, {'id': '653685855', 'title': 'Count Sub Islands', 'titleSlug': 'count-sub-islands', 'timestamp': '1646470384'}, {'id': '653648269', 'title': 'Delete and Earn', 'titleSlug': 'delete-and-earn', 'timestamp': '1646464785'}, {'id': '653369002', 'title': 'Largest Time for Given Digits', 'titleSlug': 'largest-time-for-given-digits', 'timestamp': '1646420085'}, {'id': '653362119', 'title': 'Peeking Iterator', 'titleSlug': 'peeking-iterator', 'timestamp': '1646419197'}, {'id': '653352827', 'title': 'Number of Boomerangs', 'titleSlug': 'number-of-boomerangs', 'timestamp': '1646418134'}, {'id': '653331034', 'title': 'Maximum Level Sum of a Binary Tree', 'titleSlug': 'maximum-level-sum-of-a-binary-tree', 'timestamp': '1646415650'}, {'id': '653207936', 'title': 'Number of Enclaves', 'titleSlug': 'number-of-enclaves', 'timestamp': '1646398396'}, {'id': '653190566', 'title': 'Number of Closed Islands', 'titleSlug': 'number-of-closed-islands', 'timestamp': '1646395023'}],
    "": []}


# will consider title slug of each submission for uniqueness
def convert_to_hashable_iterable(submission_list):
    return set(submission["titleSlug"] for submission in submission_list)


# default behaviour: last 100 AC submissions by alphasingh
def get_user_ac_submissions(username="alphasingh", limit=100):
    SIGNATURE = "recentAcSubmissions($username: String!, $limit: Int!)"
    USER = "{recentAcSubmissionList(username: $username, limit: $limit)"
    REQUIRED = "{id title titleSlug timestamp}}"
    SUBMISSION_DATA_QUERY = "query " + SIGNATURE + USER + REQUIRED
    connection = Connect("leetcode.com")
    payload = json.dumps({
        "query": SUBMISSION_DATA_QUERY,
        "variables": {
            "username": username,
            "limit": limit
        }
    })
    headers = {
        'Content-Type': 'application/json'
    }
    connection.request("POST", "/graphql", payload, headers)
    res = connection.getresponse()
    data = res.read()
    json_data = json.loads(data.decode("utf-8"))
    recent_ac_submissions = json_data['data']['recentAcSubmissionList']
    old = convert_to_hashable_iterable(old_submissions[username])
    recent = convert_to_hashable_iterable(recent_ac_submissions)
    ac_submissions_in_one_day = recent.difference(old)
    print('=' * 30 + '\t' + username + '\t' + '=' * 100)
    print(recent_ac_submissions)
    print('fetched {} recent AC submissions for username {}'.format(len(recent), username))
    print('{} new submissions compared with old'.format(len(ac_submissions_in_one_day)))
    print('new submissions', ac_submissions_in_one_day)


for name in ('alphasingh', 'jatinbindra171998', 'sam_si'):
    get_user_ac_submissions(name)
